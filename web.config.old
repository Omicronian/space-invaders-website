<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>
        <!-- Fix for subfolder directory access (EISDIR + 500 error) -->
        <rule name="Subfolder Index Rewrite" stopProcessing="true">
          <match url="^falcon9/?$" />
          <action type="Rewrite" url="falcon9/index.html" />
        </rule>
        <!-- General rule for any future subfolders (e.g., starship/) -->
        <rule name="General Subfolder SPA" stopProcessing="true">
          <match url="^(.+)/?$" />
          <conditions logicalGrouping="MatchAll">
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" />
            <add input="{REQUEST_FILENAME}" pattern=".*\.gltf|.*\.bin|.*\.png" negate="true" />
          </conditions>
          <action type="Rewrite" url="{R:1}/index.html" />
        </rule>
        <!-- Pass through static files (prevents 500 on assets) -->
        <rule name="Static Assets" stopProcessing="true">
          <match url="^(.*\.(gltf|bin|png|jpg|css|js|html))$" />
          <action type="None" />
        </rule>
      </rules>
    </rewrite>
    <!-- Ensure GLTF files are served correctly -->
    <staticContent>
      <mimeMap fileExtension=".gltf" mimeType="model/gltf+json" />
      <mimeMap fileExtension=".bin" mimeType="application/octet-stream" />
      <mimeMap fileExtension=".png" mimeType="image/png" />
    </staticContent>
    <!-- Handler for static content -->
    <handlers>
      <add name="StaticFile" path="*" verb="*" modules="StaticFileModule" resourceType="Either" requireAccess="Read" />
    </handlers>
  </system.webServer>
</configuration>
