<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Falcon 9 – Photorealistic Horizontal Inferno</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{margin:0;overflow:hidden;background:#000;font-family:Arial}
  #load{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-size:32px;background:#000;z-index:999}
</style>
</head>
<body>
<div id="load">Launching Falcon 9...</div>

<!-- OFFICIAL Three.js CDN – always correct MIME types -->
<script type="importmap">
{
  "imports": {
    "three": "https://threejs.org/build/three.module.js",
    "three/addons/": "https://threejs.org/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';
import {EffectComposer} from 'three/addons/postprocessing/EffectComposer.js';
import {RenderPass} from 'three/addons/postprocessing/RenderPass.js';
import {UnrealBloomPass} from 'three/addons/postprocessing/UnrealBloomPass.js';

document.getElementById('load').remove();

// Scene
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 5000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));
const bloom = new UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.8, 0.4, 0.85);
composer.addPass(bloom);

// Lighting & stars
scene.add(new THREE.AmbientLight(0x404060, 1));
scene.add(new THREE.DirectionalLight(0xffffff, 4).position.set(100,100,100));

const stars = new THREE.Points(
  new THREE.BufferGeometry().setAttribute('position',
    new THREE.Float32BufferAttribute(Float32Array.from({length:60000},()=>THREE.MathUtils.randFloatSpread(4000)),3)),
  new THREE.PointsMaterial({color:0xffffff,size:1})
);
scene.add(stars);

// Rocket
const rocket = new THREE.Group();
rocket.rotation.y = Math.PI/2;
rocket.position.x = -140;
scene.add(rocket);

// Epic flames
const flameGeo = new THREE.BufferGeometry();
const pos = new Float32Array(18000);
const sz = new Float32Array(6000);
for(let i=0;i<6000;i++){
  pos[3*i]   = (Math.random()-0.5)*12;
  pos[3*i+1] = -Math.random()*60;
  pos[3*i+2] = (Math.random()-0.5)*12;
  sz[i] = Math.random()*8+5;
}
flameGeo.setAttribute('position', new THREE.BufferAttribute(pos,3));
flameGeo.setAttribute('size', new THREE.BufferAttribute(sz,1));

const flames = new THREE.Points(flameGeo, new THREE.ShaderMaterial({
  uniforms: {c:{value:new THREE.Color(0xffaa00)}},
  vertexShader: `attribute float size;
    void main(){
      vec4 mv = modelViewMatrix * vec4(position,1.0);
      gl_PointSize = size * 700.0 / -mv.z;
      gl_Position = projectionMatrix * mv;
    }`,
  fragmentShader: `uniform vec3 c;
    void main(){
      if(length(gl_PointCoord-vec2(0.5))>0.5) discard;
      gl_FragColor = vec4(c,1.0);
    }`,
  transparent:true, blending:THREE.AdditiveBlending, depthWrite:false
}));
flames.position.y = -25;
flames.visible = false;
rocket.add(flames);

// Load your real model
new GLTFLoader().setPath('assets/').load('scene.gltf',
  gltf => {
    const m = gltf.scene;
    m.scale.set(3.5,3.5,3.5);
    rocket.add(m);
    console.log("Your photoreal Falcon 9 loaded!");
  },
  undefined,
  () => {
    console.log("Using fallback rocket");
    rocket.add(new THREE.Mesh(new THREE.CylinderGeometry(2.5,2.5,90,64),
      new THREE.MeshStandardMaterial({color:0xcccccc,metalness:0.95,roughness:0.1})));
  }
);

camera.position.set(-60,40,150);

let t=0;
function animate(){
  requestAnimationFrame(animate);
  t += 0.016;

  rocket.position.x = -140 + t*18;
  if(t>3) flames.visible = true;
  if(t>12){
    bloom.strength = 15;
    flames.material.uniforms.c.value.set(0xff0000);
    camera.position.x += (Math.random()-0.5)*20;
    camera.position.y += (Math.random()-0.5)*15;
  }
  composer.render();
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
  composer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
