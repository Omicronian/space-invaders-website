<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Falcon 9 Photorealistic Horizontal Inferno</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>body{margin:0;overflow:hidden;background:#000}canvas{display:block}</style>

<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/postprocessing/UnrealBloomPass.js"></script>
</head>
<body>

<script>
// Scene
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(65, innerWidth/innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// Post-processing
const composer = new THREE.EffectComposer(renderer);
composer.addPass(new THREE.RenderPass(scene, camera));
const bloom = new THREE.UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.6, 0.4, 0.85);
composer.addPass(bloom);

// Lighting
scene.add(new THREE.AmbientLight(0x404060, 1));
const sun = new THREE.DirectionalLight(0xfff0ea, 2.5);
sun.position.set(20,30,20);
sun.castShadow = true;
scene.add(sun);

// Stars
const stars = new THREE.BufferGeometry();
const verts = [];
for(let i=0;i<20000;i++) verts.push(THREE.MathUtils.randFloatSpread(3000),THREE.MathUtils.randFloatSpread(3000),THREE.MathUtils.randFloatSpread(3000));
stars.setAttribute('position', new THREE.Float32BufferAttribute(verts,3));
scene.add(new THREE.Points(stars, new THREE.PointsMaterial({color:0xffffff,size:0.7})));

// Rocket container
const rocket = new THREE.Group();
rocket.position.set(-80, 0, 0);
rocket.rotation.y = Math.PI / 2; // horizontal
scene.add(rocket);

// Volumetric flames
const flameGeo = new THREE.BufferGeometry();
const flamePos = new Float32Array(5000*3);
const flameSize = new Float32Array(5000);
for(let i=0;i<5000;i++){
  flamePos[i*3]   = (Math.random()-0.5)*6;
  flamePos[i*3+1] = -Math.random()*30;
  flamePos[i*3+2] = (Math.random()-0.5)*6;
  flameSize[i] = Math.random()*4 + 2;
}
flameGeo.setAttribute('position', new THREE.BufferAttribute(flamePos,3));
flameGeo.setAttribute('size', new THREE.BufferAttribute(flameSize,1));

const flameMat = new THREE.ShaderMaterial({
  uniforms:{time:{value:0},color:{value:new THREE.Color(0xffaa33)}},
  vertexShader:`
    attribute float size;
    varying float vAlpha;
    void main(){
      vec4 mv = modelViewMatrix * vec4(position,1.0);
      gl_PointSize = size * 400.0 / -mv.z;
      vAlpha = clamp(1.0 - (position.y / -30.0),0.0,1.0);
      gl_Position = projectionMatrix * mv;
    }`,
  fragmentShader:`
    varying float vAlpha;
    uniform vec3 color;
    void main(){
      if(length(gl_PointCoord-vec2(0.5))>0.5) discard;
      gl_FragColor = vec4(color, vAlpha);
    }`,
  transparent:true, blending:THREE.AdditiveBlending, depthWrite:false
});

const flames = new THREE.Points(flameGeo, flameMat);
flames.position.set(0,-17,0);
flames.visible = false;
rocket.add(flames);

// LOAD YOUR EXACT MODEL + TEXTURES
const loader = new THREE.GLTFLoader();
loader.setPath('assets/');                 // ← this tells Three.js where textures live
loader.load('scene.gltf', (gltf) => {      // ← exact filename
  const model = gltf.scene;
  model.scale.set(2.5,2.5,2.5);
  model.traverse(child => {
    if(child.isMesh){
      child.castShadow = child.receiveShadow = true;
    }
  });
  rocket.add(model);
  console.log("Real Falcon 9 loaded with your 3 textures!");
}, undefined, (err) => {
  console.error("Model failed → using procedural fallback", err);
  // simple fallback cylinder so you never see blank page
  rocket.add(new THREE.Mesh(new THREE.CylinderGeometry(2,2,50,64), 
    new THREE.MeshStandardMaterial({color:0xcccccc,metalness:0.9,roughness:0.1})));
});

// Camera
camera.position.set(-30,15,60);

// Animation
let t = 0;
function animate(){
  requestAnimationFrame(animate);
  t += 0.016;

  rocket.position.x = -80 + t*11;          // cross screen in ~12s
  if(t>3) flames.visible = true;

  if(t>12){
    bloom.strength = 7 + Math.sin(t*50)*5;
    flameMat.uniforms.color.value.set(0xff1100);
    camera.position.x += (Math.random()-0.5)*6;
    camera.position.y += (Math.random()-0.5)*4;
  }

  flameMat.uniforms.time.value = t;
  composer.render();
}
animate();

// Resize
addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
  composer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
