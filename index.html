<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Falcon 9 – Clean & Perfect</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>body{margin:0;overflow:hidden;background:#000}</style>
</head>
<body>

<script type="importmap">
{"imports":{"three":"https://threejs.org/build/three.module.js","three/addons/":"https://threejs.org/examples/jsm/"}}
</script>

<script type="module">
import * as THREE from 'three';
import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';

const scene    = new THREE.Scene();
const camera   = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0x404060, 2));
const sun = new THREE.DirectionalLight(0xffffff, 3);
sun.position.set(100, 100, 100);
scene.add(sun);

// Stars
scene.add(new THREE.Points(
  new THREE.BufferGeometry().setAttribute('position',
    new THREE.Float32BufferAttribute(Float32Array.from({length:30000},()=>THREE.MathUtils.randFloatSpread(2000)),3)),
  new THREE.PointsMaterial({color:0xffffff,size:1})
));

// Rocket container
const rocket = new THREE.Group();
rocket.rotation.y = Math.PI/2;
rocket.position.x = -120;
scene.add(rocket);

// Engine flames
const flameGeo = new THREE.BufferGeometry();
const pos = new Float32Array(9000);
for(let i=0;i<3000;i++){
  pos[i*3]   = (Math.random()-0.5)*10;
  pos[i*3+1] = -Math.random()*50;
  pos[i*3+2] = (Math.random()-0.5)*10;
}
flameGeo.setAttribute('position', new THREE.BufferAttribute(pos,3));

const flames = new THREE.Points(flameGeo, new THREE.ShaderMaterial({
  uniforms: {c:{value:new THREE.Color(0xffaa33)}},
  vertexShader: `void main(){
    vec4 mv = modelViewMatrix * vec4(position,1.0);
    gl_PointSize = 800.0 / -mv.z;
    gl_Position = projectionMatrix * mv;
  }`,
  fragmentShader: `uniform vec3 c;
    void main(){
      if(length(gl_PointCoord-vec2(0.5))>0.5) discard;
      gl_FragColor = vec4(c,1.0);
    }`,
  transparent:true, blending:THREE.AdditiveBlending
}));
flames.position.y = -28;
rocket.add(flames);

// LOAD YOUR REAL MODEL – FIXED
const loader = new GLTFLoader();
loader.setPath('assets/');

loader.load('scene.gltf', 
  (gltf) => {
    const model = gltf.scene;          // this is the correct Object3D
    model.scale.set(3.8, 3.8, 3.8);
    rocket.add(model);
  },
  undefined,
  () => {
    // Beautiful chrome fallback
    const fallback = new THREE.Mesh(
      new THREE.CylinderGeometry(2.6, 2.6, 100, 64),
      new THREE.MeshPhysicalMaterial({
        color: 0xeeeeee,
        metalness: 1,
        roughness: 0.08,
        clearcoat: 1,
        clearcoatRoughness: 0
      })
    );
    rocket.add(fallback);
  }
);

camera.position.set(-60, 30, 140);

function animate()
