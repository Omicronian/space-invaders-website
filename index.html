<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Photorealistic Falcon 9 Launch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #container { width: 100vw; height: 100vh; }
    canvas { display: block; }
  </style>
  <!-- Three.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
</head>
<body>
  <div id="container"></div>
  <script>
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Soft shadows for realism
    document.getElementById('container').appendChild(renderer.domElement);

    // Post-processing for bloom (glow on flames)
    const composer = new THREE.EffectComposer(renderer);
    const renderPass = new THREE.RenderPass(scene, camera);
    composer.addPass(renderPass);
    const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
    composer.addPass(bloomPass);

    // Lighting: Key, fill, and rim for photorealism
    const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 5);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    // Stars background
    const starsGeometry = new THREE.BufferGeometry();
    const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.005 });
    const starsVertices = [];
    for (let i = 0; i < 10000; i++) {
      starsVertices.push(THREE.MathUtils.randFloatSpread(2000));
      starsVertices.push(THREE.MathUtils.randFloatSpread(2000));
      starsVertices.push(THREE.MathUtils.randFloatSpread(2000));
    }
    starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
    const stars = new THREE.Points(starsGeometry, starsMaterial);
    scene.add(stars);

    // Load Falcon 9 model
    const loader = new THREE.GLTFLoader();
    let rocket;
    loader.load('assets/falcon9.gltf', (gltf) => { // Replace with your model path
      rocket = gltf.scene;
      rocket.scale.set(0.5, 0.5, 0.5); // Adjust scale
      rocket.position.set(-20, 0, 0);
      rocket.castShadow = true;
      rocket.receiveShadow = true;
      scene.add(rocket);
    }, undefined, (error) => console.error('Model load error:', error));

    // Flame particles (photorealistic: turbulent, glowing)
    const flameParticles = 2000;
    const flameGeometry = new THREE.BufferGeometry();
    const flamePositions = new Float32Array(flameParticles * 3);
    const flameVelocities = new Float32Array(flameParticles * 3);
    for (let i = 0; i < flameParticles; i++) {
      flamePositions[i * 3] = (Math.random() - 0.5) * 0.1; // X
      flamePositions[i * 3 + 1] = -Math.random() * 5; // Y (downward)
      flamePositions[i * 3 + 2] = (Math.random() - 0.5) * 0.05; // Z
      flameVelocities[i * 3 + 1] = -0.1 - Math.random() * 0.05; // Fall speed
    }
    flameGeometry.setAttribute('position', new THREE.BufferAttribute(flamePositions, 3));
    const flameMaterial = new THREE.PointsMaterial({
      size: 0.02,
      color: new THREE.Color().setHSL(0.1, 1, Math.random() * 0.5 + 0.5), // Orange-yellow glow
      transparent: true,
      opacity: 0.8,
      blending: THREE.AdditiveBlending // For fire bloom
    });
    const flames = new THREE.Points(flameGeometry, flameMaterial);
    flames.visible = false;
    scene.add(flames);

    // Animation loop
    let time = 0;
    function animate() {
      requestAnimationFrame(animate);
      time += 0.01;

      // Fly horizontal
      if (rocket) {
        rocket.position.x = -20 + time * 2; // Speed: cross in 10s
        if (time > 5) flames.visible = true; // Flames after takeoff
      }

      // Animate flames (physics: gravity + turbulence)
      const positions = flameGeometry.attributes.position.array;
      for (let i = 0; i < flameParticles; i++) {
        positions[i * 3 + 1] += flameVelocities[i * 3 + 1]; // Fall
        if (positions[i * 3 + 1] < -10) positions[i * 3 + 1] = 0; // Reset
        positions[i * 3] += Math.sin(time + i) * 0.001; // Turbulence
      }
      flameGeometry.attributes.position.needsUpdate = true;

      // Camera follow
      camera.position.set(rocket ? rocket.position.x - 10 : 0, 2, 5);
      camera.lookAt(rocket ? rocket.position : new THREE.Vector3(0,0,0));

      // Inferno at end (t=10s)
      if (time > 10) {
        // Explosion: Scale flames massively + add red tint
        flames.material.color.setHex(0xff0000);
        bloomPass.strength = 3; // Intense glow
        // Screen shake
        camera.position.x += (Math.random() - 0.5) * 0.5;
      }

      composer.render();
    }
    animate();

    // Resize handler
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      composer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
