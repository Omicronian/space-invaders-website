<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Falcon 9 Clean Fly-By</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; overflow:hidden; background:#000; }
</style>
</head>
<body>

<script type="importmap">
{"imports":{"three":"https://threejs.org/build/three.module.js","three/addons/":"https://threejs.org/examples/jsm/"}}
</script>

<script type="module">
import * as THREE from 'three';
import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';

// Scene
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

// Soft lighting
scene.add(new THREE.AmbientLight(0x404060, 2));
scene.add(new THREE.DirectionalLight(0xffffff, 3).position.set(50, 50, 50));

// Simple starfield
const stars = new THREE.Points(
  new THREE.BufferGeometry().setAttribute('position',
    new THREE.Float32BufferAttribute(
      Float32Array.from({length:30000}, () => THREE.MathUtils.randFloatSpread(2000)), 3
    )),
  new THREE.PointsMaterial({color:0xffffff, size:1})
);
scene.add(stars);

// Rocket container
const rocket = new THREE.Group();
rocket.rotation.y = Math.PI / 2;  // horizontal
rocket.position.set(-80, 0, 0);
scene.add(rocket);

// Engine flames (soft orange â†’ white core)
const flameGeo = new THREE.BufferGeometry();
const positions = new Float32Array(9000);
for(let i=0; i<3000; i++){
  positions[i*3]   = (Math.random()-0.5)*8;
  positions[i*3+1] = -Math.random()*40;
  positions[i*3+2] = (Math.random()-0.5)*8;
}
flameGeo.setAttribute('position', new THREE.BufferAttribute(positions,3));

const flames = new THREE.Points(flameGeo, new THREE.ShaderMaterial({
  uniforms: {color: {value: new THREE.Color(0xffaa33)}},
  vertexShader: `void main(){
    vec4 mv = modelViewMatrix * vec4(position,1.0);
    gl_PointSize = 600.0 / -mv.z;
    gl_Position = projectionMatrix * mv;
  }`,
  fragmentShader: `uniform vec3 color;
    void main(){
      if(length(gl_PointCoord-vec2(0.5))>0.5) discard;
      gl_FragColor = vec4(color,1.0);
    }`,
  transparent: true,
  blending: THREE.AdditiveBlending
}));
flames.position.y = -25;
rocket.add(flames);

// Load your real Falcon 9
new GLTFLoader().setPath('assets/').load('scene.gltf',
  gltf => {
    const model = gltf.scene;
    model.scale.set(3.5, 3.5, 3.5);
    rocket.add(model);
  },
  undefined,
  () => {
    // Fallback: shiny chrome rocket (still looks great)
    const fallback = new THREE.Mesh(
      new THREE.CylinderGeometry(2.5, 2.5, 90, 64),
      new THREE.MeshPhysicalMaterial({color:0xdddddd, metalness:1, roughness:0.1, clearcoat:1})
    );
    rocket.add(fallback);
  }
);

// Camera
camera.position.set(-40, 20, 100);
camera.lookAt(0, 0, 0);

// Simple smooth flight
function animate() {
  requestAnimationFrame(animate);
  rocket.position.x += 0.8;   // smooth constant speed
  renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', () => {
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
